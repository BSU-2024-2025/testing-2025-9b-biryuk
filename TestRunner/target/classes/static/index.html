<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>QA Dashboard</title>
    <style>
        :root { --bg: #121212; --panel: #1e1e1e; --text: #e0e0e0; --accent: #007acc; --green: #28a745; --red: #dc3545; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); padding: 0; margin: 0; display: flex; height: 100vh; }

        /* Layout */
        .container { display: flex; width: 100%; height: 100%; }
        .panel { flex: 1; padding: 20px; display: flex; flex-direction: column; border-right: 1px solid #333; }

        h2 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-top: 0; }

        /* Manual Testing Section */
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input[type="text"] { flex: 1; padding: 12px; border-radius: 4px; border: 1px solid #444; background: #252526; color: white; font-size: 16px; font-family: monospace; }
        button { padding: 10px 20px; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { opacity: 0.8; }
        .btn-calc { background-color: var(--accent); }
        .manual-result { background: #252526; padding: 15px; border-radius: 4px; min-height: 50px; border-left: 4px solid var(--accent); }

        /* Auto Testing Section */
        .controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-start { background-color: var(--green); }
        .btn-stop { background-color: var(--red); }
        .btn-pause { background-color: #ffc107; color: black; }
        .btn-save { background-color: #6c757d; }

        #log-window {
            flex: 1;
            background-color: black;
            color: #0f0;
            font-family: 'Consolas', monospace;
            padding: 15px;
            overflow-y: auto;
            border-radius: 4px;
            border: 1px solid #333;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h2>üõ† –†—É—á–Ω–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: <code>x=5; y=10; x*y</code>)</p>

        <div class="input-group">
            <input type="text" id="expressionInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∑–¥–µ—Å—å..." onkeydown="if(event.key==='Enter') sendManual()">
            <button class="btn-calc" onclick="sendManual()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
        </div>

        <div id="manualResult" class="manual-result">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
    </div>

    <div class="panel">
        <h2>–ê–≤—Ç–æ-–¢–µ—Å—Ç—ã (TestNG + Selenium)</h2>

        <div class="controls">
            <button class="btn-start" onclick="control('start')">–ó–∞–ø—É—Å–∫</button>
            <button class="btn-pause" onclick="control('pause')">–ü–∞—É–∑–∞</button>
            <button class="btn-stop" onclick="control('stop')">–°—Ç–æ–ø</button>
            <button class="btn-save" onclick="saveResults()">Save Log</button>
        </div>

        <div id="log-window">
            <div>–û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã...</div>
        </div>
    </div>
</div>

<script>
    let pollInterval;

    // –†—É—á–Ω–æ–π –≤–≤–æ–¥
    function sendManual() {
        const expr = document.getElementById('expressionInput').value;
        fetch('/api/calculate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ expression: expr })
        })
        .then(res => res.json())
        .then(data => {
            const resDiv = document.getElementById('manualResult');
            resDiv.innerText = data.result;
            resDiv.style.borderLeftColor = data.result.includes("–û—à–∏–±–∫–∞") ? "#dc3545" : "#007acc";
        });
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏
    function control(action) {
        fetch('/api/' + action, { method: 'POST' });

        if (action === 'start') {
            document.getElementById('log-window').innerHTML = "<div>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>";
            if (pollInterval) clearInterval(pollInterval);
            pollInterval = setInterval(fetchLogs, 500); // –û–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫
        }
        if (action === 'stop') {
             appendLog("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...");
        }
    }

    function fetchLogs() {
        fetch('/api/logs')
            .then(res => res.json())
            .then(logs => {
                const logWindow = document.getElementById('log-window');
                logWindow.innerHTML = logs.map(line => {
                    let color = 'inherit';
                    if (line.includes('PASSED')) color = '#28a745';
                    if (line.includes('FAILED') || line.includes('ERROR')) color = '#dc3545';
                    if (line.includes('START')) color = '#ffc107';
                    return `<div style="color:${color}">${line}</div>`;
                }).join('');
                logWindow.scrollTop = logWindow.scrollHeight;
            });
    }

    function saveResults() {
        let name = prompt("–ò–º—è —Ñ–∞–π–ª–∞:");
        if (name) fetch('/api/save', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ filename: name })
        });
    }

    function appendLog(msg) {
        document.getElementById('log-window').innerHTML += `<div>${msg}</div>`;
    }
</script>

</body>
</html>