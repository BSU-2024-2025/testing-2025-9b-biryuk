<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Test Automation Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; padding: 20px; }
        .controls { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }

        /* –ö–Ω–æ–ø–∫–∏ */
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; border: none; border-radius: 5px; color: white; }
        .btn-start { background-color: #28a745; } /* –ó–µ–ª–µ–Ω—ã–π */
        .btn-stop { background-color: #dc3545; }  /* –ö—Ä–∞—Å–Ω—ã–π */
        .btn-pause { background-color: #ffc107; color: black; } /* –ñ–µ–ª—Ç—ã–π */
        .btn-save { background-color: #007bff; }  /* –°–∏–Ω–∏–π */

        /* –û–∫–Ω–æ –ª–æ–≥–æ–≤ */
        #log-window {
            width: 100%;
            height: 400px;
            background-color: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            overflow-y: scroll; /* –°–∫—Ä–æ–ª–ª–∏–Ω–≥ */
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* –ò–∫–æ–Ω–∫–∏ (—Å–∏–º–≤–æ–ª—ã) */
        .icon-play::before { content: "‚ñ∂"; margin-right: 5px; }
        .icon-stop::before { content: "‚ñ†"; margin-right: 5px; }
        .icon-pause::before { content: "‚è∏"; margin-right: 5px; }
        .icon-save::before { content: "üíæ"; margin-right: 5px; }
    </style>
</head>
<body>

<h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∞–º–∏ (Calculator & Parser)</h1>

<div class="controls">
    <button class="btn-start icon-play" onclick="startTests()">–ó–∞–ø—É—Å–∫</button>
    <button class="btn-stop icon-stop" onclick="stopTests()">–°—Ç–æ–ø</button>
    <button class="btn-pause icon-pause" onclick="togglePause()">–ü–∞—É–∑–∞</button>
    <button class="btn-save icon-save" onclick="saveResults()">Save</button>
</div>

<h3>–ñ—É—Ä–Ω–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Log):</h3>
<div id="log-window">
    <div>–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</div>
</div>

<script>
    let pollInterval;
    let isPaused = false;

    function startTests() {
        fetch('/api/start', { method: 'POST' });
        document.getElementById('log-window').innerHTML = "<div>–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã...</div>";
        isPaused = false;
        // –ù–∞—á–∏–Ω–∞–µ–º –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –∫–∞–∂–¥—ã–µ 500–º—Å
        if (pollInterval) clearInterval(pollInterval);
        pollInterval = setInterval(fetchLogs, 500);
    }

    function stopTests() {
        fetch('/api/stop', { method: 'POST' });
        if (pollInterval) clearInterval(pollInterval);
        appendLog(">>> –¢–µ—Å—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.");
    }

    function togglePause() {
        isPaused = !isPaused;
        let btn = document.querySelector('.btn-pause');
        btn.innerText = isPaused ? "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" : "–ü–∞—É–∑–∞";
        appendLog(isPaused ? ">>> –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –ø–∞—É–∑–µ (—Ç–µ—Å—Ç—ã –∏–¥—É—Ç –≤ —Ñ–æ–Ω–µ)" : ">>> –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è");
    }

    function saveResults() {
        let filename = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", "test_results");
        if (filename) {
            fetch('/api/save', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ filename: filename })
            })
            .then(response => response.text())
            .then(data => alert(data));
        }
    }

    function fetchLogs() {
        if (isPaused) return;

        fetch('/api/logs')
            .then(response => response.json())
            .then(logs => {
                const logWindow = document.getElementById('log-window');
                logWindow.innerHTML = logs.map(line => `<div>${line}</div>`).join('');
                // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
                logWindow.scrollTop = logWindow.scrollHeight;
            });
    }

    function appendLog(msg) {
        const logWindow = document.getElementById('log-window');
        logWindow.innerHTML += `<div>${msg}</div>`;
        logWindow.scrollTop = logWindow.scrollHeight;
    }
</script>
</body>
</html>